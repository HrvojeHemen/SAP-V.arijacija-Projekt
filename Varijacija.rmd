---
title: "Varijacija.pdf"
output: pdf_document
---

```{r setup, include=FALSE}

imdb <- read.csv(file = 'IMDB.csv')
library(tidyr)
library(tidyverse)
library(modeest)

```
# Uvod

\indent{} Za ovu analizu podataka koristit ćemo skup podataka o filmovima s IMDB-a

```{r imdb}
nrow(imdb)
```
Možemo vidjeti kako ovaj skup podtaka sadrži opise 5044 filmova. Kategorički podaci koje nam ovaj skup podataka pruža su žanr filma, glavni glumci,redatelj filma, mjesto snimanja filma i drugi. Neki od metričkih podataka su zarada filma, ocjena filma na IMDB-u, budžet filma i drugi.

```{r}
summary(imdb)
```
Pogledajmo prvo pregled vrijednosti iz tablice za sve stupce. Većina stupaca sadrži jako malo nepostojećih vrijednosti osim stupca sa zaradom filmova koji sadrži 884 nepostojeće vrijednosti što je gotovo 20% ukupnog broja filmova te zaključci koje bismo donijeli na temelju tih podataka ne bi najbolje prikazivali stvarnu sliku.

# Deskriptivna analiza nekih podataka

## Žanrovi filmova i njihove ocjene
Pogledajmo prvo jesu li podaci za ocjene ispravno učitani

```{r}
cat("Type: ", class(imdb$imdb_score))
```
Podaci su ispravno učitani te možemo nastaviti s analizom.
Za početak ćemo pogledati koliko podataka nema zapisane ocjene ili niti jedan žanr u našoj tablici.

```{r}
sum(is.na(imdb$genres))
sum(is.na(imdb$imdb_score))
```

Vidimo kako nema nepostojećih vrijednosti.
Nakon što smo provjerili postoje li sve vrijednosti za sve filmove moramo svaki redak razdvojiti na više njih ovisno o njegovom broju žanrova.
Ovo radimo kako bismo mogli napraviti stupčasti dijagram i promatrati vrijednosti za pojedine žanrove.

```{r}
imdbSep <- separate_rows(imdb, genres, sep = "\\|")
```

Pogledajmo prvo koliko imamo žanrova u našem skupu podataka.

```{r}
numGenres <- length(unique(imdbSep$genres))
cat("Number of genres: ", numGenres, "\n")
```

Pogledajmo sada koliko određeni žanr ima snimljenih filmova.
```{r}
# 
imdbSep %>% group_by(genres) %>% summarise(number_of_movies = length(unique(movie_title))) -> grupa
grupa[grupa$number_of_movies < 10,]
```
Možemo vidjeti kako žanrovi "Film-Noir", "Game-Show", "News", "Reality-TV" i "Short" imaju 6 ili manje snimljenih filmova.
To je veoma mali broj u odnosu na ostatak žanrova te zato odbacujemo ove žanrove iz daljnje analize zbog premalog broja podataka.

```{r}
row.genres.remove <- c("Film-Noir", "Game-Show", "News", "Reality-TV","Short")

genres_edited <- imdbSep[!(imdbSep$genres %in% row.genres.remove), ]
```
Nakon što smo izbacili one žanrove s malim brojem snimljenih filmova možemo pogledati prosječne ocjene uz pojedini žanr.
Za mjeru centra koristili smo aritmetičku sredinu. 

```{r}

genres_edited %>% group_by(genres) %>% summarise(AVG_imdb_rating = mean(imdb_score)) -> summary.result.avg

##postavljanje podataka na barplot
data_bar <- summary.result.avg$AVG_imdb_rating
names(data_bar) <- summary.result.avg$genres

##uredjivanje marginaS
par(mar=c(7.5, 4.1, 4.1, 2.1), font.axis = 2, font.lab =  2)

barplot(data_bar, 
        main="Prosječna ocjena filmova za pojedine zanrove",
        ylab = "IMDB score [0-10]",2
        las = 2, col="lightblue")
```
Gore dobiveni dijagram jako podsjeća na uniformnu distribuciju. Možemo pogledati i box plot za različite žanrove.

```{r}
par(mar=c(8, 4.1, 0, 0), font.axis = 2, font.lab =  2)
boxplot(genres_edited$imdb_score ~ genres_edited$genres, las=2, xlab="", ylab="IMDB score", ylim=c(0,10))
mtext("Genres", side = 1, line = 7)

```
Možemo vidjeti kako pojedini žanrovi (Action, Comedy, Drama) sadrže veliku količinu stršećih vrijednosti što je i očekivano s obzirom da su upravo to najpopularniji žanrovi filmova te sadrže jako velik broj podataka (n > 1000).

Pogledajmo sada standardne devijacije za pojedini žanr.

```{r}
genres_edited %>% group_by(genres) %>% summarise(sd = sd(imdb_score)) -> summary.result.sd

data_bar <- summary.result.sd$sd
names(data_bar) <- summary.result.sd$genres

par(mar=c(7.5, 4.1, 4.1, 2.1), font.axis = 2, font.lab =  2)

barplot(data_bar, 
        main="Standardna devijacija ocjena filmova za pojedine zanrove",
        ylab = "Standardna devijacija",
        las = 2, col="lightblue")

```
Vidimo kako samo žanr "Biography" značajnije odstupa od drugih standardnih varijacija, no i dalje možemo pretpostaviti kako se radi o uniformnoj distribuciji.

## Trajanje filma
Podaci za trajanje filma dani su u minutama. Pogledajmo prvo jesu li podaci ispravno učitani i maknimo nepostojeće vrijednosti.

```{r}
duration <- imdb$duration
duration <- duration[!is.na(duration)]
cat("Type: ", class(duration), "\n")
```

Vidimo da su podaci ispravno zapisani u obliku integera. Sada možemo nastaviti s analizom.
Prvo ćemo pogledati histogram i pravokutni dijagram.

```{r}
# Histogram

hist(duration,
     breaks=20,
     main="Film's duration in minutes",
     xlab="Duration (min)",
     ylab='Frequency' )

# Pravokutni dijagram

boxplot(duration,
        main="Box and whisker plot for duration",
        ylab="Duration (min)")


```
Možemo vidjeti kako ovaj skup podataka i nije baš najzahvalniji za prikaz pomoću stupčastog dijagrama jer je rang ovog skupa podataka dosta velik te imamo jako puno stršećih vrijednosti. Međutim možemo pretpostaviti kako ova distribucija nalikuje na multimodalnu.

```{r}
cat("Rang je: ", max(duration) - min(duration))
```
Pogledajmo sada mjere centra.
```{r}

# Medijan
cat("Median: ",median(duration),"\n")

# Podrezana aritmetička sredina s uklanjanjem po 10% najmanjih i najvecih podataka
cat("10% trimmed mean: ", mean(duration, trim=0.1), "\n")

# Aritmeticka sredina
cat("Mean: ",mean(duration),"\n")

# Mod
cat("Mod: ",mfv(duration),"\n")

```
Zbog velikog broja stršećih vrijednosti najbolji pokazatelj centra je mod koji je robusan i neosjetljiv na ekstreme kojih u ovom skupu podataka ima jako mnogo.
Nadalje pogledajmo mjere rasipanja.

```{r}
# IQR
cat("IQR: ",IQR(duration),"\n")

# Varijanca
cat("Variance: ",var(duration),"\n")

# Standardna devijacija
cat("Standard deviation: ",sd(duration),"\n")

# Koeficijent varijacije
cat("Variation coefficient: ",sd(duration)/mean(duration),"\n")

```
Ovdje je zanimljivo pogledati interkvartilni rang koji je izuzetno mali u odnosu na rang cijelog skupa podataka. Iznosi tek 25 što je i očekivano
s obzirom da većina filmova traje od otprlike 90 do 120 minuta. Upravo odavdje dolazi velik broj stršećih vrijednosti.


# Testiranje Hipoteza

## Imaju li neki žanrovi značajno različite ocjene na IMDB-u?
Kod ove hipoteze zanima nas postoji li neka značajna razlika kod ocjena različitih žanrova na IMDB-u.
U nastavku ćemo testirati našu hipotezu. Promtoriti ćemo prosječne ocjene kod filmova koji pripadaju žanrovima "Biography" i "Horror".

```{r}
biography <- genres_edited[genres_edited$genres=="Biography",]
horror <- genres_edited[genres_edited$genres=="Horror",]

#Izdvajamo samo stupce sa zanrovima, imenima filmova i ocjenama
biography <- biography[c(10,12,26)]
horror <- horror[c(10,12,26)]

##Provjera postoje li filmovi koji su ujedno i Biography i Horror
biography.movie_titles <- biography["movie_title"]
horror.movie_titles <- horror["movie_title"]
remove.list <-Reduce(intersect, list(biography.movie_titles, horror.movie_titles))

cat("Broj filmova koji pripadju žanrovima \"Horror\" i \"Biography\": ", nrow(remove.list))
```
Vidimo da samo 1 film pripada u oba žanra te zbog pretpostavke nezavisnosti koju ćemo koristiti u našem testu odbaciti ćemo ovaj podatak.

```{r}
biography <- biography[!(biography$movie_title %in% remove.list), ]
horror <- horror[!(horror$movie_title %in% remove.list), ]
```

Sada kada smo dobili nezavisne podatke potrebno je provjeriti dolaze li podaci iz normalne razdiobe. Ovo ćemo napraviti uz pomoć QQ-plota.

```{r}
# QQ plot za ocjene zanra biography
qqnorm(biography$imdb_score, pch = 1, frame = FALSE,main='Ocjene zanra biography')
qqline(biography$imdb_score, col = "blue", lwd = 2)

# QQ plot za ocjene zanra horror
qqnorm(horror$imdb_score, pch = 1, frame = FALSE,main='Ocjene zanra horror')
qqline(horror$imdb_score, col = "blue", lwd = 2)

```
Iz QQ-plota možemo vidjeti kako ocjene za žanr "Horror" dolaze iz normalne razdiobe, no isto ne možemo reći i za žanr "Biography".
Pogledajmo imamo li veći broj stršećih vrijednosti koje utječu na ovaj rezultat

```{r}
boxplot(biography$imdb_score, horror$imdb_score,
        names=c("Biography IMDB score", "Horror IMDB score"),
        main = "Boxplot of IMDB scores")
```
Možemo vidjeti kako imamo dosta stršećih vrijednosti kod žanra "Biography" te ih zato uklanjamo kako bi dobili bolju pretpostavku normalnosti.

```{r}
biography.edited <- biography[!biography$imdb_score %in% boxplot.stats(biography$imdb_score)$out,]
```

Pogledajmo sada podatke na QQ-plotu.
```{r}
qqnorm(biography.edited$imdb_score, pch = 1, frame = FALSE,main='Ocjene zanra biography')
qqline(biography.edited$imdb_score, col = "blue", lwd = 2)
```

Sada kada smo postigli normalnost i nezavisnost ocjena za žanrove "Biography" i "Horror" možemo krenuti provoditi test.

$$1) \quad H_0 \quad \dots \quad  Prosječna \ ocjena \ žanra \ Biography \ je \ jednaka \ ocjeni \ žanra \ Horror $$ $$ \mu_1 = \mu_2 $$
$$2) \quad H_1 \quad \dots \quad  Prosječna \ ocjena \ žanra \ Biography \ nije \ jednaka \ ocjeni \ žanra \ Horror $$ $$ \mu_1 \neq \mu_2 $$
$$3) \quad \alpha = 0.05$$
Prije nego krenemo s provođenjem testa moramo provjeriti jesu li varijance naših podataka jednake kako bi znali provest odgovarajući t-test.
$$1) \quad H_0 \quad \dots \quad  Varijance \ distribucija \ se \ ne \ razlikuju$$ $$ \sigma_1 = \sigma_2$$
$$2) \quad H_1 \quad \dots \quad  Varijance \ distribucija \ se \ razlikuju$$ $$ \sigma_1 \neq \sigma_2$$
$$3) \quad \alpha = 0.05$$
```{r}
var.test(biography$imdb_score, horror$imdb_score)
```
Zbog jako male p-vrijednosti zaključujemo da na razini značajnosti od 5% varijance nisu jednake. Nakon toga provodimo t-test za za različite varijance. 

```{r}
t.test(biography.edited$imdb_score, horror$imdb_score, alt = "two.sided", var.equal = FALSE)
```
Možemo vidjeti kako je p-vrijednost izrazito mala te iz tog razloga odbacujemo hipotezu $H_0$ u korist $H_1$ te zaključujemo da na razini značajnosti od 5% sredine ocjena za žanrove "Biography" i "Horror" nisu jednake. 

Pogledajmo sada usporedbu 5 žanrova (Action, Comedy, Drama, Thriller, Romance) i njihovih prosječnih ocjena korištenjem ANOVE. Izabrali smo upravo ove žanrove zbog veličine njihvog uzorka (n > 1000) što naravno utječe na ispravnost naših zaključaka i smanjuje šanse za pogreške prve i druge vrste.
Imamo problem jer podaci iz uzoraka nisu nezavisni te je zato potrebno gledati samo filmove koji ne pripadaju nijednom od ostalih 4 žanrova.

Kao što smo vidjeli u deskriptivnoj analizi postoji velik broj stršećih vrijednosti što može znatno utjecati na pretpostavku normalnosti podataka koja nam je potrebna.
Izbacimo prvo stršeće vrijednosti iz skupa podataka za pojedine žanrove
```{r}
#Svi filmovi pojedinog zanra
action <- genres_edited[genres_edited$genres=="Action",]
comedy <- genres_edited[genres_edited$genres=="Comedy",]
drama <- genres_edited[genres_edited$genres=="Drama",]
thriller <- genres_edited[genres_edited$genres=="Thriller",]
romance <- genres_edited[genres_edited$genres=="Romance",]

#Izbacivanje strsecih vrijednosti
action <- action[!action$imdb_score %in% boxplot.stats(action$imdb_score)$out,]
comedy <- comedy[!comedy$imdb_score %in% boxplot.stats(comedy$imdb_score)$out,]
drama <- drama[!drama$imdb_score %in% boxplot.stats(drama$imdb_score)$out,]
thriller <- thriller[!thriller$imdb_score %in% boxplot.stats(thriller$imdb_score)$out,]
romance <- romance[!romance$imdb_score %in% boxplot.stats(romance$imdb_score)$out,]

```

Izbacimo nakon toga filmove koji pripadaju u više žanrova iz našeg skupa.

```{r}
#Imena filmova pojedinog zanra (da lakse maknemo filmove koji pripadaju vise zanrova)
action.movie_title <- action["movie_title"]
comedy.movie_title <- comedy["movie_title"]
drama.movie_title <- drama["movie_title"]
thriller.movie_title <- thriller["movie_title"]
romance.movie_title <- romance["movie_title"]

#Liste filmova drugih zanrova (ako je ime filma u toj listi onda pripada vise zanrova)
action.remove_list <- Reduce(union,list(comedy.movie_title, drama.movie_title, thriller.movie_title, romance.movie_title))
comedy.remove_list <- Reduce(union, list(action.movie_title, drama.movie_title, thriller.movie_title, romance.movie_title))
drama.remove_list <- Reduce(union, list(action.movie_title, comedy.movie_title, thriller.movie_title, romance.movie_title))
thriller.remove_list <- Reduce(union, list(action.movie_title, drama.movie_title, comedy.movie_title, romance.movie_title))
romance.remove_list <- Reduce(union, list(action.movie_title, drama.movie_title, thriller.movie_title, comedy.movie_title))

#Micanje svih filmova iz drugih zanrova iz skupa podataka

action.nez <- action[!(action$movie_title %in% action.remove_list$movie_title), ]
comedy.nez <- comedy[!(comedy$movie_title %in% comedy.remove_list$movie_title), ]
drama.nez <- drama[!(drama$movie_title %in% drama.remove_list$movie_title),]
thriller.nez <- thriller[!(thriller$movie_title %in% thriller.remove_list$movie_title), ]
romance.nez <- romance[!(romance$movie_title %in% romance.remove_list$movie_title),]
```
Nakon transformacija dobili smo filmove koji pripadaju samo jednom žanru, a ne nijednom od ostalih četiri.
Pogledajmo sada koliko je filmova ostalo koji ne pripadaju ni jednom drugom žanru.

``` {r}
nrow(action.nez)
nrow(comedy.nez)
nrow(drama.nez)
nrow(thriller.nez)
nrow(romance.nez)
```
Vidimo kako je broj filmova žanra "Romance" dosta manji od ostalih, međutim takvo ponašanje je očekivano s obzirom da većina filmova ovog žanra spada ili u žanr "Comedy" ili žanr "Drama".
Sada kada smo postigli nezavisnost podataka moramo provjerit normalnost. To ćemo napraviti uz pomoć Lillieforsove inačice KS testa.

``` {r}
require(nortest)

lillie.test(action.nez$imdb_score)
lillie.test(comedy.nez$imdb_score)
lillie.test(drama.nez$imdb_score)
lillie.test(thriller.nez$imdb_score)
lillie.test(romance.nez$imdb_score)

```
Možemo vidjeti kako žanr "Drama" ima jako malu p-vrijednost pa za njega ne možemo pretpostaviti normalnost. Za ostale žanrove na razini značajnosti od 1% vrijedi pretpostavka normalnosti.
U daljnoj provedbi testa izbacujemo žanr "Drama" iz analize zbog nezadovoljenih pretpostavki testa.
Sljedeća pretpostavka koja nam je potrebna za analizu je homogenost varijanci svih uzoraka. To ćemo provjeriti uz pomoć Bartlettovog testa koji će zbog prijašnje pretpostavke normalnosti još bolje prikazati rezultate.

``` {r}
# Pojedinacne varijance svakog zanra
var(action.nez$imdb_score)
var(comedy.nez$imdb_score)
var(thriller.nez$imdb_score)
var(romance.nez$imdb_score)

# Dodajemo listu ocjena u varijable
a <- action.nez$imdb_score
b <- comedy.nez$imdb_score
c <- thriller.nez$imdb_score
d <- romance.nez$imdb_score

bartlett.test(list(a,b,c,d))

```
Vidimo kako Bartlettov test daje p-vrijednost od nešto više od 8% što nam, na razini značajnosti od 1%, dozvoljava da pretpostavimo da su varijance ova 4 žanra jednake.
Nakon što smo zadovoljili pretpostavke normalnosti, nezavisnosti i homogenosti varijanci uzorka možemo provesti ANOVU sa sljedećim hipotezama: 
$$ \begin{aligned}
  H_0 & : \mu_1 = \mu_2 = \mu_3 = \mu_4 \\
  H_1 & : \neg H_0.
\end{aligned} $$

``` {r}
# Sve filmove dodajemo u jednu listu
allNames <- c(action.nez$movie_title, comedy.nez$movie_title)
allNames <- c(allNames, romance.nez$movie_title)
allNames <- c(allNames, thriller.nez$movie_title)
allGenres <- c("Action", "Comedy", "Thriller", "Romance")
#Editamo pocetni skup
edited <- genres_edited[genres_edited$movie_title %in% allNames,]
edited <- edited[edited$genres %in% allGenres,]
#Provedba ANOVE
test <- aov(imdb_score ~ genres, data=edited)
summary(test)
```
Vidimo da je p-vrijednost jako mala te na razini značajnosti od 1% odbacujemo nultu hipotezu i zaključujemo da srednje vrijednosti ocjena za barem dva žanra od žanrova "Action", "Comedy", "Thriller", "Romance" nisu jednake.
Tako se naša inicijalna pretpostavka o uniformnoj distribuciji srednjih vrijednosti ocjena pokazala netočnom te zaključujemo da postoji značajna razlika u prosječnim ocjenama pojedinih žanrova.
